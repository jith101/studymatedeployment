<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Admin Dashboard - Bootstrap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css'>
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css'>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Barlow&display=swap');

    body{
      font-family: 'Barlow', sans-serif;
    }

    a:hover{
      text-decoration: none;
    }

    .border-left{
      border-left: 2px solid var(--primary) !important;
    }

    .sidebar{
      top: 0;
      left : 0;
      z-index : 100;
      overflow-y: auto;
    }

    .overlay{
      background-color: rgb(0 0 0 / 45%);
      z-index: 99;
    }

    @media screen and (max-width: 767px){
      .sidebar{
        max-width: 18rem;
        transform : translateX(-100%);
        transition : transform 0.4s ease-out;
      }
      .sidebar.active{
        transform : translateX(0);
      }
    }

    .sidebar img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 col-lg-2 px-0 position-fixed h-100 bg-white shadow-sm sidebar" id="sidebar">
      <img src="https://t4.ftcdn.net/jpg/02/27/45/09/360_F_227450952_KQCMShHPOPebUXklULsKsROk5AvN6H1H.jpg" alt="Admin Icon">
      <center>
        <h1 class="dropdown-header text-primary">{{ session['name'] }}</h1> <!-- Increased to h1 and set to blue -->
        <small class="dropdown-item text-muted text-primary">Role: Teacher</small> <!-- Role text in blue -->

      </center>
      <div class="list-group rounded-0">
        <a href="{{ url_for('teacher_dashboard_show') }}" class="list-group-item list-group-item-action border-0 d-flex align-items-center">
          
          <span class="ml-2">Assigned Course</span>
        </a>
        
        <a href="{{ url_for('teacher_schedule_class') }}" class="list-group-item list-group-item-action border-0 d-flex align-items-center">
          
          <span class="ml-2">Schedule Class</span>
        </a>
        <a href="{{ url_for('teacher_notes') }}" class="list-group-item list-group-item-action active border-0 d-flex align-items-center">
          <span class="ml-2">Access Notes</span>
        </a>
        <a href="{{ url_for('teacher_assignment') }}" class="list-group-item list-group-item-action  border-0 d-flex align-items-center">
          <span class="ml-2">Access assignments</span>
      </a>
      
        <!-- <a href="#" class="list-group-item list-group-item-action border-0 align-items-center">
          <span class="bi bi-box"></span>
          <span class="ml-2">Products</span>
        </a>
        <button class="list-group-item list-group-item-action border-0 d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#sale-collapse">
          <div>
            <span class="bi bi-cart-dash"></span>
            <span class="ml-2">Sales</span>
          </div>
          <span class="bi bi-chevron-down small"></span>
        </button>
        <div class="collapse" id="sale-collapse" data-parent="#sidebar">
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action border-0 pl-5">Customers</a>
            <a href="#" class="list-group-item list-group-item-action border-0 pl-5">Sale Orders</a>
          </div>
        </div>
        <button class="list-group-item list-group-item-action border-0 d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#purchase-collapse">
          <div>
            <span class="bi bi-cart-plus"></span>
            <span class="ml-2">Purchase</span>
          </div>
          <span class="bi bi-chevron-down small"></span>
        </button>
        <div class="collapse" id="purchase-collapse" data-parent="#sidebar">
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action border-0 pl-5">Sellers</a>
            <a href="#" class="list-group-item list-group-item-action border-0 pl-5">Purchase Orders</a>
          </div>
        </div> -->
      </div>
    </div>
    <div class="w-100 vh-100 position-fixed overlay d-none" id="sidebar-overlay"></div>
    <div class="col-md-9 col-lg-10 ml-md-auto px-0">
      <nav class="w-100 d-flex px-4 py-2 mb-4 shadow-sm">
        <button class="btn py-0 d-lg-none" id="open-sidebar">
          <span class="bi bi-list text-primary h3"></span>
        </button>
        <div class="dropdown ml-auto">
          <button class="btn py-0 d-flex align-items-center" id="logout-dropdown" data-toggle="dropdown" aria-expanded="false">
            <span class="mx-2" style="color: #007BFF;">{{ session['name'] }}</span>
            <span class="bi bi-person text-primary h4"></span>
            <span class="bi bi-chevron-down ml-1 mb-2 small"></span>
          </button>
          <div class="dropdown-menu dropdown-menu-right border-0 shadow-sm" aria-labelledby="logout-dropdown">
            <h6 class="dropdown-header">{{ session['name'] }}</h6> <!-- Display user's name -->
        <a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a>
          </div>
        </div>
      </nav>
      <main class="container-fluid">
        <section class="row">
          <!-- <div class="col-md-6 col-lg-4">
            <article class="p-4 rounded shadow-sm border-left mb-4">
              <a href="#" class="d-flex align-items-center">
                <span class="bi bi-box h5"></span>
                <h5 class="ml-2">Products</h5>
              </a>
            </article>
          </div> -->
          <!-- <div class="col-md-6 col-lg-4">
            <article class="p-4 rounded shadow-sm border-left mb-4">
              <a href="#" class="d-flex align-items-center">
                <span class="bi bi-person h5"></span>
                <h5 class="ml-2">Customers</h5>
              </a>
            </article>
          </div> -->
          <!-- <div class="col-md-6 col-lg-4">
            <article class="p-4 rounded shadow-sm border-left mb-4">
              <a href="#" class="d-flex align-items-center">
                <span class="bi bi-person-check h5"></span>
                <h5 class="ml-2">Sellers</h5>
              </a>
            </article>
          </div> -->
        </section>
        <div class="jumbotron jumbotron-fluid rounded bg-white border-0 shadow-sm border-left px-4">
          <div class="container">
            <div class="container mt-5">
                <h3>Select a Course</h3>
                <select id="course-select" class="form-select">
                  <option selected disabled>Select Course</option>
                  {% for course in courses %}
                    <option value="{{ course.course_id }}">{{ course.name }}</option>
                  {% endfor %}
                </select>
              
                <!-- Add Note Button -->
                <button id="addNoteBtn" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addNoteModal">Add Note</button>
              
                <!-- Past Notes -->
                <h3 class="mt-5">Past Notes</h3>
                <div id="past-notes"></div>
              </div>
              
              <!-- Add Note Modal -->
              <div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="addNoteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="addNoteModalLabel">Add New Note</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form id="addNoteForm">
                        <div class="mb-3">
                          <label for="note-name" class="form-label">Note Name</label>
                          <input type="text" class="form-control" id="note-name" name="note_name" required>
                        </div>
                        <div class="mb-3">
                          <label for="note-file" class="form-label">Upload Note</label>
                          <input type="file" class="form-control" id="note-file" name="note_file" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Note</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Update Note Modal -->
              <!-- Update Note Modal -->
              <div class="modal fade" id="updateNoteModal" tabindex="-1" aria-labelledby="updateNoteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateNoteModalLabel">Update Note</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="updateNoteForm" enctype="multipart/form-data"> <!-- Added enctype for file upload -->
          <input type="hidden" id="update-note-id" name="note_id"> <!-- Include note_id here -->
          <div class="mb-3">
            <label for="update-note-name" class="form-label">Note Name</label>
            <input type="text" class="form-control" id="update-note-name" name="note_name" required> <!-- Added name attribute -->
          </div>
          <div class="mb-3">
            <label for="update-note-file" class="form-label">Upload New Note</label>
            <input type="file" class="form-control" id="update-note-file" name="note_file"> <!-- Added name attribute -->
          </div>
          <button type="submit" class="btn btn-primary">Update Note</button>
        </form>
      </div>
    </div>
  </div>
</div>

              
              <!-- View Note Modal -->
              <div class="modal fade" id="viewNoteModal" tabindex="-1" aria-labelledby="viewNoteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="viewNoteModalLabel">View Note</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="note-viewer">
                      <!-- Note content will be loaded here -->
                    </div>
                  </div>
                </div>
              </div>
          </div>
        </div>
        <!-- Button to analyze sentences -->
        <!-- <div class="text-center">
          <button id="analyzeButton" class="btn btn-primary">Analyze Sentences</button>
        </div> -->
      </main>
    </div>
  </div>
</div>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js'></script>
<script>
  $(document).ready(function(){
    $("#open-sidebar").click(function(){
      $(".sidebar").toggleClass("active");
      $("#sidebar-overlay").toggleClass("d-none");
    });

    $("#sidebar-overlay").click(function(){
      $(".sidebar").toggleClass("active");
      $("#sidebar-overlay").toggleClass("d-none");
    });
    $('#addNoteBtn').on('click', function() {
    $('#addNoteModal').modal('show');
  });

    // document.getElementById('analyzeButton').addEventListener('click', function() {
    //   window.location.href = '/model_output';
    // });
    $('#course-select').on('change', function() {
    var course_id = $(this).val();
    $.post('/get_past_notes', { course_id: course_id }, function(data) {
      var noteList = '<ul class="list-group">';
      $.each(data, function(index, note) {
        console.log(note.name);
        noteList += `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            ${note.note_name}
            <div>
              <button class="btn btn-warning btn-sm update-btn" data-id="${note.nid}" data-bs-toggle="modal" data-bs-target="#updateNoteModal">Update</button>
              <button class="btn btn-danger btn-sm delete-btn" data-id="${note.nid}">Delete</button>
              <button class="btn btn-info btn-sm view-btn" data-id="${note.nid}">View</button>
            </div>
          </li>`;
      });
      noteList += '</ul>';
      $('#past-notes').html(noteList);
    });
  });

  // Add new note using AJAX
  // When clicking the "Update" button, populate the modal with the note details
$(document).on('click', '.update-btn', function() {
    var noteId = $(this).data('id');  // Get the note ID from the button's data-id attribute
    var noteName = $(this).closest('li').find('.note-name').text();  // Get the note name from the list (adjust selector if necessary)
    
    $('#update-note-id').val(noteId);  // Set the note ID in the hidden input field
    $('#update-note-name').val(noteName);  // Set the note name in the input field
    
    $('#updateNoteModal').modal('show');  // Show the modal
});

// Form submission with file handling and updating note details
$('#addNoteForm').on('submit', function(e) {
  e.preventDefault();
  var formData = new FormData(this);

  // If the form is for updating, append the note ID and course ID
  if (this.id === 'updateNoteForm') {
    formData.append('nid', $('#update-note-id').val());
    formData.append('note_name', $('#update-note-name').val());
  } else {
    formData.append('course_id', $('#course-select').val());
  }

  // Debugging: Print each form field to console
  for (var pair of formData.entries()) {
    console.log(pair[0] + ', ' + pair[1]);
  }

  $.ajax({
    url: this.id === 'updateNoteForm' ? '/update_note' : '/upload_note',  // Dynamic URL based on form
    type: 'POST',
    data: formData,
    contentType: false,
    processData: false,
    success: function(response) {
      alert(response.status);
      $('#' + this.id === 'updateNoteForm' ? 'updateNoteModal' : 'addNoteModal').modal('hide');  // Close the appropriate modal
      $('#course-select').trigger('change');  // Refresh past notes
    }.bind(this)  // Bind the context so 'this' refers to the form element
  });
});



  // Update note logic
  $(document).on('click', '.update-btn', function() {
    var noteId = $(this).data('id');
    $.post('/view_note', { nid: noteId }, function(data) {
      $('#update-note-id').val(data.nid);
      $('#update-note-name').val(data.name);
      $('#updateNoteModal').modal('show');
    });
  });

  $('#updateNoteForm').on('submit', function(e) {
    e.preventDefault();
    var noteId = $('#update-note-id').val();  // Get note ID
    var noteName = $('#update-note-name').val();  // Get note name
    
    var formData = new FormData(this); // Create FormData object from the form
    formData.append('nid', noteId);  // Add note ID to FormData
    formData.append('note_name', noteName);  // Add note name to FormData

    $.ajax({
      url: '/update_note',
      type: 'POST',
      data: formData,
      contentType: false,
      processData: false,
      success: function(response) {
        alert(response.status);
        $('#updateNoteModal').modal('hide');
        $('#course-select').trigger('change'); // Refresh past notes
      }
    });
});




  // Delete note logic
  $(document).on('click', '.delete-btn', function() {
    var noteId = $(this).data('id');
    $.post('/delete_note', { nid: noteId }, function(response) {
      alert(response.status);
      $('#course-select').trigger('change'); // Refresh past notes
    });
  });

  // View note logic
  $(document).on('click', '.view-btn', function() {
    var noteId = $(this).data('id');
    $.post('/view_note', { nid: noteId }, function(data) {
        $('#note-viewer').html('<embed src="/uploads/' + data.link + '" width="100%" height="400px">');
        $('#viewNoteModal').modal('show');
    }).fail(function(xhr) {
        console.error('Error retrieving note:', xhr.responseText); // Handle error
    });
});


  });
</script>
</body>
</html>
